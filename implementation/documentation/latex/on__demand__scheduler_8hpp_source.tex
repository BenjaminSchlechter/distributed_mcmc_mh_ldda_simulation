\hypertarget{on__demand__scheduler_8hpp_source}{}\doxysection{on\+\_\+demand\+\_\+scheduler.\+hpp}
\label{on__demand__scheduler_8hpp_source}\index{distributed\_computation/on\_demand\_scheduler.hpp@{distributed\_computation/on\_demand\_scheduler.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00001}00001 \textcolor{preprocessor}{\#ifndef ON\_DEMAND\_SCHEDULER}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00002}00002 \textcolor{preprocessor}{\#define ON\_DEMAND\_SCHEDULER}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00004}00004 \textcolor{preprocessor}{\#include <cstddef>}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00005}00005 \textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00006}00006 \textcolor{preprocessor}{\#include <deque>}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00007}00007 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00008}00008 \textcolor{preprocessor}{\#include <chrono>}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00009}00009 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00010}00010 \textcolor{preprocessor}{\#include <mpi.h>}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00012}00012 \textcolor{preprocessor}{\#include "{}../util/mpi/mpi\_util.hpp"{}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00013}00013 \textcolor{preprocessor}{\#include "{}../util/mpi/mpi\_async\_communication.hpp"{}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00015}00015 \textcolor{preprocessor}{\#include "{}lazy\_round\_robin\_scheduler.hpp"{}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00022}00022 \textcolor{keyword}{template}<}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00023}00023     \textcolor{keyword}{typename} \mbox{\hyperlink{classremote__execution__context}{remote\_execution\_context\_t}},}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00024}00024     \textcolor{keyword}{class }\mbox{\hyperlink{classBitsery__TypeAbstractionAdapter}{type\_abstraction\_adapter\_t}} =}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00025}00025         \mbox{\hyperlink{classremote__execution__context_afeca01b55eefcd45323ef8519082f271}{remote\_execution\_context\_t::type\_abstraction\_adapter\_t}}>}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00026}00026 \textcolor{keyword}{requires} (\mbox{\hyperlink{classBitsery__TypeAbstractionAdapter_a313fb32b81b17e3db42b9e4bcc325ca7}{type\_abstraction\_adapter\_t::is\_TypeAbstractionAdapter}})}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00027}\mbox{\hyperlink{classon__demand__scheduler}{00027}} \textcolor{keyword}{class} \mbox{\hyperlink{classon__demand__scheduler}{on\_demand\_scheduler}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00028}00028 \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00029}00029     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00031}\mbox{\hyperlink{classon__demand__scheduler_a293403db2631c4a1917b1769bbc2680b}{00031}}         \textcolor{keyword}{using} \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} = \mbox{\hyperlink{classremote__execution__context_a0c4faddd4beacda59e7cf8fe828f8055}{remote\_execution\_context\_t::rpc\_message\_t}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00033}\mbox{\hyperlink{classon__demand__scheduler_a1cec19f47764d0aea07150c8e6a477b4}{00033}}         \textcolor{keyword}{using} \mbox{\hyperlink{classon__demand__scheduler_a1cec19f47764d0aea07150c8e6a477b4}{buffer\_t}} = \mbox{\hyperlink{classBitsery__TypeAbstractionAdapter_a5ed863076fb0646189a96d41d03311fe}{type\_abstraction\_adapter\_t::abstract\_type}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00035}00035     \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00037}\mbox{\hyperlink{classon__demand__scheduler_a78ee675fe189aac64bb13946911124b6}{00037}}         \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{const} std::size\_t workload\_capacity = 2;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00040}\mbox{\hyperlink{classon__demand__scheduler_a0621d7a308b8589ac6c1beb9e622536d}{00040}}         \textcolor{keyword}{using} \mbox{\hyperlink{classlazy__round__robin__scheduler}{scheduler\_t}} = \mbox{\hyperlink{classlazy__round__robin__scheduler}{lazy\_round\_robin\_scheduler<workload\_capacity>}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00041}00041 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00043}\mbox{\hyperlink{classon__demand__scheduler_a0b433c97abe36cd894aa73f154768735}{00043}}         \textcolor{keyword}{using} \mbox{\hyperlink{classon__demand__scheduler_a0b433c97abe36cd894aa73f154768735}{uptr\_scheduler\_t}} = std::unique\_ptr<scheduler\_t>;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00046}\mbox{\hyperlink{classon__demand__scheduler_a32dd6a651bb6d3a1f2061fa6f241bdc6}{00046}}         \mbox{\hyperlink{classon__demand__scheduler_a0b433c97abe36cd894aa73f154768735}{uptr\_scheduler\_t}} \mbox{\hyperlink{classon__demand__scheduler_a32dd6a651bb6d3a1f2061fa6f241bdc6}{scheduler}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00047}00047 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00049}\mbox{\hyperlink{classon__demand__scheduler_a2d36d13327f19621945914bd485ce01a}{00049}}         std::deque<rpc\_message\_t> \mbox{\hyperlink{classon__demand__scheduler_a2d36d13327f19621945914bd485ce01a}{tasks}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00052}\mbox{\hyperlink{classon__demand__scheduler_a9c8f54e111b715757a5739edaade1d40}{00052}}         \mbox{\hyperlink{classBitsery__TypeAbstractionAdapter}{type\_abstraction\_adapter\_t}} \mbox{\hyperlink{classon__demand__scheduler_a9c8f54e111b715757a5739edaade1d40}{taa}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00055}\mbox{\hyperlink{classon__demand__scheduler_a6e259f8ea7dc508f055df17ec8ecf29f}{00055}}         std::size\_t \mbox{\hyperlink{classon__demand__scheduler_a6e259f8ea7dc508f055df17ec8ecf29f}{num\_waiting\_for\_reply}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00056}00056         }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00058}\mbox{\hyperlink{classon__demand__scheduler_a9d40410dd90c08878375df9f0d8f71c7}{00058}}         \mbox{\hyperlink{classasync__comm__out}{async\_comm\_out}} \mbox{\hyperlink{classon__demand__scheduler_a9d40410dd90c08878375df9f0d8f71c7}{background\_comm}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00059}00059         \textcolor{comment}{// fake\_async\_comm\_out background\_comm;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00061}00061 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00064}\mbox{\hyperlink{classon__demand__scheduler_a28dbb2d143b88e0a4435770e9ecb1ece}{00064}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classon__demand__scheduler_a28dbb2d143b88e0a4435770e9ecb1ece}{process\_msg}}(MPI\_Status \&status)}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00065}00065         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00066}00066             assert(0 == env\_comm\_id);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00067}00067             }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00068}00068             \textcolor{keywordflow}{if} (0 < get\_message\_size(\&status)) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00069}00069                 \textcolor{comment}{// std::cout << "{}process\_msg"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00070}00070                 execute(get\_msg(status));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00071}00071             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00072}00072                 assert(MPI\_SUCCESS == MPI\_Recv(}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00073}00073                     \textcolor{keyword}{nullptr},}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00074}00074                     0,}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00075}00075                     MPI\_BYTE,}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00076}00076                     status.MPI\_SOURCE,}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00077}00077                     mpi\_tag,}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00078}00078                     env\_comm,}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00079}00079                     \&status));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00080}00080             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00082}00082             assert(0 < status.MPI\_SOURCE);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00083}00083             scheduler-\/>task\_finished(status.MPI\_SOURCE -\/ 1);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00084}00084             num\_waiting\_for\_reply-\/-\/;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00085}00085         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00089}\mbox{\hyperlink{classon__demand__scheduler_a16912607bc6bf503b0c74322055f7434}{00089}}         \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} \mbox{\hyperlink{classon__demand__scheduler_a16912607bc6bf503b0c74322055f7434}{get\_msg}}(MPI\_Status \&status)}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00090}00090         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00091}00091             \mbox{\hyperlink{classon__demand__scheduler_a1cec19f47764d0aea07150c8e6a477b4}{buffer\_t}} b;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00092}00092             get\_message(env\_comm, \&status, b);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00093}00093             \textcolor{comment}{// print\_vector("{}get\_msg:"{}, b);}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00094}00094             \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} msg;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00095}00095             assert(0 < b.size());}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00096}00096             assert(taa.\mbox{\hyperlink{classBitsery__TypeAbstractionAdapter_aee1cacc94c877f694630120c921cbd1f}{deserialize}}(b, msg));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00098}00098             \textcolor{comment}{// std::cout << "{}c msg from: "{} << status.MPI\_SOURCE}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00099}00099                 \textcolor{comment}{// << "{} with tag "{} << status.MPI\_TAG << std::endl;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00100}00100             \textcolor{keywordflow}{return} msg;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00101}00101         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00105}\mbox{\hyperlink{classon__demand__scheduler_abe55a62eba95a7a8df8a25de9e3a6bf6}{00105}}         \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} \mbox{\hyperlink{classon__demand__scheduler_abe55a62eba95a7a8df8a25de9e3a6bf6}{wait\_for\_msg}}()}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00106}00106         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00107}00107             assert(0 != env\_comm\_id);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00108}00108             MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00109}00109             wait\_for\_message(env\_comm, \&status, mpi\_tag);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00110}00110             \textcolor{comment}{// std::cout << "{}wait\_for\_msg"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00111}00111             \textcolor{keywordflow}{return} get\_msg(status);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00112}00112         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00113}00113 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00116}\mbox{\hyperlink{classon__demand__scheduler_a5602b0c08663eca976ddf9dd1c9fa18e}{00116}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classon__demand__scheduler_a5602b0c08663eca976ddf9dd1c9fa18e}{execute}}(\textcolor{keyword}{auto} msg)}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00117}00117         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00118}00118             \textcolor{comment}{// std::cout << "{}executing "{} << msg.function\_name}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00119}00119                 \textcolor{comment}{// << "{} (id: "{} << msg.id << "{}) with"{}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00120}00120                 \textcolor{comment}{// << (msg.answer\_required ? "{}"{} : "{}out"{})}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00121}00121                 \textcolor{comment}{// << "{} reply on "{} << env\_comm\_id}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00122}00122                 \textcolor{comment}{// << "{} (crc: "{} << (int) msg.crc << "{})"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00124}00124             assert(msg.check\_crc());}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00126}00126             \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} result = rec.execute\_rpc(msg);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00127}00127             assert(!result.\mbox{\hyperlink{classrpc__message_aa4682d4743ad24c4b7041a670c40bd75}{answer\_required}});}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00128}00128 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00129}00129             \textcolor{keywordflow}{if} (msg.answer\_required) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00130}00130                 result.\mbox{\hyperlink{classrpc__message_ad2ab845f684b67538794d407f720c7b6}{compute\_crc}}();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00131}00131             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00133}00133             \textcolor{keywordflow}{if} (0 == env\_comm\_id) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00134}00134                 \textcolor{keywordflow}{if} (msg.answer\_required) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00135}00135                     rec.execute\_rpc(result);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00136}00136                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00137}00137             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00138}00138                 \textcolor{keywordflow}{if} (msg.answer\_required) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00139}00139                     \mbox{\hyperlink{classon__demand__scheduler_a1cec19f47764d0aea07150c8e6a477b4}{buffer\_t}} b = taa.\mbox{\hyperlink{classBitsery__TypeAbstractionAdapter_ab76d04229530de5add9614514363bd45}{serialize}}(result);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00140}00140                     background\_comm.\mbox{\hyperlink{classasync__comm__out_a5b942bd597c82f9f8fa5e7ba1ef6e71c}{send\_message}}(}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00141}00141                         env\_comm, 0, mpi\_tag, std::move(b));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00142}00142                     \textcolor{comment}{// print\_vector("{}execute\_send\_reply:"{}, b);}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00143}00143                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00144}00144                     ping(env\_comm, 0, mpi\_tag);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00145}00145                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00146}00146             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00147}00147         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00149}00149 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00151}\mbox{\hyperlink{classon__demand__scheduler_acf82a7e1eefe7b221c4acc40e482fe37}{00151}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classon__demand__scheduler_acf82a7e1eefe7b221c4acc40e482fe37}{feed\_hungry\_workers}}()}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00152}00152         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00153}00153             assert(0 == env\_comm\_id);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00154}00154 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00155}00155             \textcolor{keywordflow}{while} (scheduler-\/>is\_process\_without\_work())}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00156}00156             \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00157}00157                 \textcolor{keywordflow}{if} (tasks.empty()) \{ \textcolor{keywordflow}{return}; \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00158}00158 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00159}00159                 \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} task = tasks.front();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00160}00160                 tasks.pop\_front();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00161}00161                 schedule(task);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00162}00162             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00163}00163         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00164}00164 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00166}00166     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00168}\mbox{\hyperlink{classon__demand__scheduler_a8c8af6a8afd999113b28217272a124b2}{00168}}         MPI\_Comm \mbox{\hyperlink{classon__demand__scheduler_a8c8af6a8afd999113b28217272a124b2}{env\_comm}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00169}00169 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00171}\mbox{\hyperlink{classon__demand__scheduler_a37258431a5415f6986436fe1b8f44888}{00171}}         \textcolor{keyword}{const} \textcolor{keywordtype}{int} \mbox{\hyperlink{classon__demand__scheduler_a37258431a5415f6986436fe1b8f44888}{env\_comm\_id}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00174}\mbox{\hyperlink{classon__demand__scheduler_a6a3d12dd164d1f34e35290c7e56702b8}{00174}}         \textcolor{keyword}{const} \textcolor{keywordtype}{int} \mbox{\hyperlink{classon__demand__scheduler_a6a3d12dd164d1f34e35290c7e56702b8}{env\_comm\_size}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00175}00175 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00177}\mbox{\hyperlink{classon__demand__scheduler_a4e00dc97c2631f16bea4f77453c83eec}{00177}}         \textcolor{keyword}{const} \textcolor{keywordtype}{int} \mbox{\hyperlink{classon__demand__scheduler_a4e00dc97c2631f16bea4f77453c83eec}{mpi\_tag}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00179}00179 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00181}\mbox{\hyperlink{classon__demand__scheduler_aa7ac549c080dbbb65f7c043a1cce7f4d}{00181}}         \mbox{\hyperlink{classremote__execution__context}{remote\_execution\_context\_t}} \&\mbox{\hyperlink{classon__demand__scheduler_aa7ac549c080dbbb65f7c043a1cce7f4d}{rec}};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00182}00182 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00183}00183 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00186}\mbox{\hyperlink{classon__demand__scheduler_adcf9bf8aa00cadfe9972e4a4a80b601a}{00186}}         \mbox{\hyperlink{classon__demand__scheduler_adcf9bf8aa00cadfe9972e4a4a80b601a}{on\_demand\_scheduler}}(}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00187}00187             MPI\_Comm env\_comm,}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00188}00188             \textcolor{keywordtype}{int} mpi\_tag,}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00189}00189             \mbox{\hyperlink{classremote__execution__context}{remote\_execution\_context\_t}} \&rec}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00190}00190         ) :}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00191}00191             scheduler(nullptr),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00192}00192             tasks(),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00193}00193             taa(),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00194}00194             num\_waiting\_for\_reply(0),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00195}00195             background\_comm(),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00196}00196             env\_comm(env\_comm),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00197}00197             env\_comm\_id(mpi\_get\_comm\_rank(env\_comm)),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00198}00198             env\_comm\_size(mpi\_get\_comm\_size(env\_comm)),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00199}00199             mpi\_tag(mpi\_tag),}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00200}00200             rec(rec)}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00201}00201         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00202}00202             \textcolor{keywordflow}{if} (0 == env\_comm\_id) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00203}00203                 scheduler =}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00204}00204                     \mbox{\hyperlink{classon__demand__scheduler_a0b433c97abe36cd894aa73f154768735}{uptr\_scheduler\_t}}(\textcolor{keyword}{new} \mbox{\hyperlink{classlazy__round__robin__scheduler}{scheduler\_t}}(env\_comm\_size -\/ 1));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00205}00205             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00206}00206         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00208}00208 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00210}\mbox{\hyperlink{classon__demand__scheduler_a6784664ca608a5c10e845c2896b98944}{00210}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classon__demand__scheduler_a6784664ca608a5c10e845c2896b98944}{schedule}}(\textcolor{keyword}{auto} task, \textcolor{keywordtype}{int} target = 0)}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00211}00211         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00212}00212             assert(0 == env\_comm\_id);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00213}00213 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00214}00214             \textcolor{keywordtype}{int} target\_id = target;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00215}00215             \textcolor{keywordflow}{if} (0 == target) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00216}00216                 target\_id = 1 + scheduler-\/>get\_id\_to\_schedule\_task\_on();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00217}00217             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00218}00218 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00219}00219             \textcolor{comment}{/*int crc = */} task.compute\_crc();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00220}00220 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00221}00221             \textcolor{comment}{// std::cout << "{}ods scheduling "{} << task.function\_name}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00222}00222                 \textcolor{comment}{// << "{} (id: "{} << task.id << "{}) with"{}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00223}00223                 \textcolor{comment}{// << (task.answer\_required ? "{}"{} : "{}out"{})}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00224}00224                 \textcolor{comment}{// << "{} reply on "{} << target}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00225}00225                 \textcolor{comment}{// << "{} (crc: "{} << crc << "{})"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00226}00226 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00227}00227             \textcolor{keywordflow}{if} (0 == target\_id) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00228}00228                 tasks.push\_back(task);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00229}00229             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00230}00230                 \mbox{\hyperlink{classon__demand__scheduler_a1cec19f47764d0aea07150c8e6a477b4}{buffer\_t}} b = taa.\mbox{\hyperlink{classBitsery__TypeAbstractionAdapter_ab76d04229530de5add9614514363bd45}{serialize}}(task);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00231}00231                 background\_comm.\mbox{\hyperlink{classasync__comm__out_a5b942bd597c82f9f8fa5e7ba1ef6e71c}{send\_message}}(}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00232}00232                     env\_comm, target\_id, mpi\_tag, std::move(b));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00233}00233                 \textcolor{comment}{// print\_vector("{}schedule:"{}, b);}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00234}00234                 num\_waiting\_for\_reply++;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00235}00235             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00236}00236         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00237}00237 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00238}00238 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00240}\mbox{\hyperlink{classon__demand__scheduler_a06e9042242c536311dc16e433bb2942a}{00240}}         std::size\_t \mbox{\hyperlink{classon__demand__scheduler_a06e9042242c536311dc16e433bb2942a}{num\_tasks\_waiting}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00241}00241             \textcolor{keywordflow}{return} tasks.size();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00242}00242         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00243}00243 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00244}00244 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00246}\mbox{\hyperlink{classon__demand__scheduler_a4894c268f71f391295605530314d0c56}{00246}}         std::size\_t \mbox{\hyperlink{classon__demand__scheduler_a4894c268f71f391295605530314d0c56}{num\_tasks\_pending}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00247}00247             \textcolor{keywordflow}{return} num\_waiting\_for\_reply;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00248}00248         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00249}00249 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00250}00250 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00252}\mbox{\hyperlink{classon__demand__scheduler_aa9a18a247e7a5d3cb430d43db4527a16}{00252}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classon__demand__scheduler_aa9a18a247e7a5d3cb430d43db4527a16}{is\_work\_outstanding}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00253}00253             \textcolor{keywordflow}{return} ((0 < num\_tasks\_pending())}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00254}00254                 || (0 < num\_tasks\_waiting()))}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00255}00255                 || !background\_comm.\mbox{\hyperlink{classasync__comm_afac3f9e2ad35148b627958ba5860f79a}{communication\_is\_done}}();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00256}00256         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00257}00257 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00258}00258 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00260}\mbox{\hyperlink{classon__demand__scheduler_a865d4e72758662d46e4723ddeb424f7a}{00260}}         \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classon__demand__scheduler_a865d4e72758662d46e4723ddeb424f7a}{do\_work}}(\textcolor{keywordtype}{bool} wait\_for\_work = \textcolor{keyword}{false})}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00261}00261         \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00262}00262             \textcolor{keywordflow}{if} ((0 == env\_comm\_id) \&\& (1 < env\_comm\_size))}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00263}00263             \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00264}00264                 feed\_hungry\_workers();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00265}00265 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00266}00266                 MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00267}00267                 \textcolor{keywordflow}{while} (is\_message\_available(env\_comm, \&status, mpi\_tag))}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00268}00268                 \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00269}00269                     process\_msg(status);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00270}00270                     feed\_hungry\_workers();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00271}00271                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00272}00272 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00273}00273                 \textcolor{keywordflow}{while} (scheduler-\/>worker\_available())}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00274}00274                 \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00275}00275                     \textcolor{keywordflow}{if} (tasks.empty()) \{ \textcolor{keywordflow}{return} 0; \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00276}00276 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00277}00277                     \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} task = tasks.front();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00278}00278                     tasks.pop\_front();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00279}00279                     schedule(task);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00280}00280 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00281}00281                     \textcolor{keywordflow}{if} (is\_message\_available(env\_comm, \&status, mpi\_tag))}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00282}00282                     \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00283}00283                         process\_msg(status);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00284}00284                     \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00285}00285                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00286}00286                 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00287}00287                 background\_comm.\mbox{\hyperlink{classasync__comm_a9c10468e193957872c33fdf4266c7ec2}{test\_for\_messages}}();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00288}00288                 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00289}00289                 \textcolor{comment}{// std::cout << "{}communications\_in\_queue: "{}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00290}00290                     \textcolor{comment}{// << background\_comm.communications\_in\_queue()}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00291}00291                     \textcolor{comment}{// << std::endl;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00292}00292 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00293}00293                 \textcolor{keywordflow}{if} (wait\_for\_work) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00294}00294                     \textcolor{keywordflow}{if} (background\_comm.\mbox{\hyperlink{classasync__comm_afac3f9e2ad35148b627958ba5860f79a}{communication\_is\_done}}()) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00295}00295                         \textcolor{keywordflow}{if} (!tasks.empty()) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00296}00296                             \mbox{\hyperlink{classrpc__message}{rpc\_message\_t}} task = tasks.front();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00297}00297                             tasks.pop\_front();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00298}00298                             execute(task);}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00299}00299                         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00300}00300                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00301}00301                         background\_comm.\mbox{\hyperlink{classasync__comm_a3651921f09630c6c9297cc83daea026d}{wait\_for\_some\_messages}}();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00302}00302                     \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00303}00303                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00304}00304             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00305}00305                 MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00306}00306                 \textcolor{keywordflow}{while} (is\_message\_available(env\_comm, \&status, mpi\_tag))}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00307}00307                 \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00308}00308                     \textcolor{comment}{// std::cout << "{}message available"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00309}00309                     tasks.push\_back(get\_msg(status));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00310}00310                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00311}00311 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00312}00312                 background\_comm.\mbox{\hyperlink{classasync__comm_a9c10468e193957872c33fdf4266c7ec2}{test\_for\_messages}}();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00313}00313 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00314}00314                 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00315}00315 \textcolor{comment}{                if (tasks.empty()) \{}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00316}00316 \textcolor{comment}{                    if (wait\_for\_work \&\& (1 < env\_comm\_size)) \{}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00317}00317 \textcolor{comment}{                        tasks.push\_back(wait\_for\_msg());}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00318}00318 \textcolor{comment}{                        background\_comm.test\_for\_messages();}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00319}00319 \textcolor{comment}{                    \}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00320}00320 \textcolor{comment}{                \}}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00321}00321 \textcolor{comment}{                */}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00322}00322 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00323}00323                 \textcolor{keywordflow}{if} (wait\_for\_work \&\& (1 < env\_comm\_size)) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00324}00324                     \textcolor{keywordflow}{if} (!background\_comm.\mbox{\hyperlink{classasync__comm_afac3f9e2ad35148b627958ba5860f79a}{communication\_is\_done}}()) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00325}00325                         \textcolor{keywordflow}{while} (tasks.empty()) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00326}00326                             \textcolor{keywordflow}{if} (is\_message\_available(}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00327}00327                                 env\_comm, \&status, mpi\_tag))}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00328}00328                             \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00329}00329                                 tasks.push\_back(get\_msg(status));}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00330}00330                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00331}00331                             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00332}00332 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00333}00333                             background\_comm.\mbox{\hyperlink{classasync__comm_a5e74e9f1a8323d3e30bef4314ee58b01}{test\_for\_one\_message}}();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00334}00334                             \textcolor{keywordflow}{if} (background\_comm.\mbox{\hyperlink{classasync__comm_afac3f9e2ad35148b627958ba5860f79a}{communication\_is\_done}}())}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00335}00335                             \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00336}00336                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00337}00337                             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00338}00338                         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00339}00339                     \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00340}00340                     }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00341}00341                     \textcolor{keywordflow}{if} (tasks.empty()) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00342}00342                         tasks.push\_back(wait\_for\_msg());}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00343}00343                     \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00344}00344                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00345}00345 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00346}00346                 \textcolor{keywordflow}{if} (!tasks.empty()) \{}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00347}00347                     \textcolor{keyword}{auto} start =}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00348}00348                         std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00349}00349 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00350}00350                     execute(tasks.front());}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00351}00351 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00352}00352                     \textcolor{keyword}{auto} end =}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00353}00353                         std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00354}00354                     tasks.pop\_front();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00355}00355 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00356}00356                     \textcolor{keywordflow}{return} std::chrono::duration\_cast<}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00357}00357                         std::chrono::milliseconds>(end -\/ start).count();}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00358}00358                 \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00359}00359             \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00360}00360 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00361}00361             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00362}00362         \}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00363}00363 \};}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00364}00364 }
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00365}00365 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{on__demand__scheduler_8hpp_source_l00366}00366 }

\end{DoxyCode}
